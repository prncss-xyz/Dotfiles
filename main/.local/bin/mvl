#!/usr/bin/env sh

tt="node /home/prncss/Projects/github.com/prncss-xyz/tags/dist/index.js"
history=tags
if [ "$1" = add ]; then
  inp="$2"
	if [ ! -e "$inp" ]; then
		echo "file '$inp' doest not exists" >&2
		exit 1
	fi
	mkdir -p "$HOME"/.histories/
	if [ ! -f "$HOME/.histories/$history" ]; then
		touch "$HOME/.histories/$history"
	fi
	result="$($tt tag-all | fzf --history="$HOME/.histories/$history" --print-query | tail -1)"
	if [ -n "$result" ]; then
    $tt tag-add "$result" "$inp"
	fi
elif [ "$1" = rm ]; then
  inp="$2"
	if [ ! -e "$inp" ]; then
		echo "file '$inp' doest not exists" >&2
		exit 1
	fi
	mkdir -p "$HOME"/.histories/
	if [ ! -f "$HOME/.histories/$history" ]; then
		touch "$HOME/.histories/$history"
	fi
	result="$($tt tag-get "$inp" | fzf --history="$HOME/.histories/$history" --print-query | tail -1)"
	if [ -n "$result" ]; then
    $tt tag-rm "$result" "$inp"
	fi
elif [ "$1" = imv ]; then
	mkdir -p "$HOME"/.histories/
	if [ ! -f "$HOME/.histories/$history" ]; then
		touch "$HOME/.histories/$history"
	fi
	result="$($tt tag-all | fzf --history="$HOME/.histories/$history" --print-query | tail -1)"
	if [ -n "$result" ]; then
    $tt tag-ls -s "$result" -n "t:remove" | imv
	fi
else
	echo "unknown subcommand" >&2
	exit 1
fi
